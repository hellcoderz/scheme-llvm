task :bytecode do
  sh "llvm-as -f llvmasmtest.ll"
end

task :optimize do
  sh "opt -std-compile-opts llvmasmtest.bc -o llvmasmtest.opt.bc -f"
end

task :llvm_compile do
  sh "llc llvmasmtest.opt.bc -f"
end

task :lli do
  sh "lli llvmasmtest.opt.bc"
end

task :asm do
  sh "as -o llvmasmtest.o llvmasmtest.opt.s"
end

task :gcc do
  sh "gcc -o llvmasmtest llvmasmtest.o"
end

task :execute do
  sh "./llvmasmtest"
end

task :clean do
  sh "rm -rf *.bc *.o *.s llvmasmtest"
end

task :run => [:bytecode, :optimize, :lli]
task :run_native => [:bytecode, :optimize, :llvm_compile, :asm, :gcc, :execute]
task :default => :run_native
